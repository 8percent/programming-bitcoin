트랜잭션은 한 엔터티에서 다른 엔터티로의 가치 이동을 표현

## 5.1 트랜잭션 구성요소

1. 버전: 어떤 부가 기능을 트랜잭션이 사용할 수 있는지 규정. 첫 4바이트
2. 입력: 사용할 비트코인
3. 출력: 비트코인이 어디로 가는지
4. 록타임: 트랜잭션의 유효시점 규정. 마지막 4바이트

## 5.2 버전

- 보통 1이지만 2인 경우 있음
- OP_CHECKSEQUENCEVERIFY 오피코드를 사용하는 트랜잭션은 BIP0112에 따라 1보다 커야함

## 5.3 입력

- 비트코인의 입력은 이전 트랜잭션의 출력울 가리킴
- 본인이 소유한 비트코인을 정확히 가리키기 위해 2가지 사항 필요
  - 이전에 내가 수신한 비트코인을 가리키는 참조 정보
  - 그 비트코인이 나의 소유라는 증명: 타원곡선 서명 알고리즘(3장)을 이용
- 대부분 입력은 소유자 개인키로 만든 전자서명울 포함하고 있음
- 입력 여러개 있을 수 있으며 varint(가변정수표현)로 입력 갯수를 표현
  - 0 ~ 252: 1바이트로 표현
  - 253 ~ 2^16-1: 0xfd 이후 2바이트를 리틀엔디언으로 표현
  - 2^16 ~ 2^32-1: 0xfe 이후 4바이트를 리틀엔디언으로 표현
  - 2^32 ~ 2^64-1: 0xff 이후 8바이트를 리틀엔디언으로 표현
- 각각의 입력은 4개의 하부필드를 가짐. 처음 2개는 이전 트랜잭션의 출력, 마지막 2개는 이전 트랜잭션의 출력을 사용하는 방법
  - 이전 트랜잭션의 해시값 혹은 ID(Previous Tx ID): hash256값이어서 해시충돌이 거의 없음. 32바이트 리틀엔디언
  - 이전 트랜잭션의 출력 번호(Previous Tx index): 트랜잭션 출력이 여러개 있을 수 있어서 몇 번째 출력인지 알려주는 값. 4바이트 리틀엔디언
  - 해제 스크립트(ScriptSig): 스마트 계약 언어인 Script를 구성하는 한 부분. 6장에서 자세히 다룰 예정. 가변 길이
  - 시퀀스(Sequence): 원래 목적은 매우 빈번한 거래를 록타임 필드와 함께 표현하기 위함이었으나 현재는 RBF(Replace-By-Fee)와 OP_CHECKSEQUENCEVERIFY로 사용됨

> 빈번한 거래를 위해 시퀀스와 록타임 필드를 고안했음. 채굴자들이 악용하기 쉽다는 단점이 있음. 이 아이디어가 발전해서 지불 채널이 고안되었고 지불 채널은 라이트닝 네트워크의 토대가 됨.

## 5.4 출력

- 비트코인의 거래 후 종착지 정의
- 각 트랜잭션은 하나 이상의 출력을 가짐
- varint 형식으로 출력 갯수 표현
- 각각의 출력은 2개의 하부필드로 구성
  - 비트코인 금액: 비트코인의 양이고 사토시 단위로 표현. 1억사토시 = 1비트코인. 최대치는 2100만 비트코인 = 2100조 사토시. 2^32 보다 크기 때문에 8바이트 리틀엔디언
  - 잠금 스크립트(ScriptPubKey): 스마트 계약 언어인 Script로 쓰임. 가변 길이

> UTXO는 Unspent transaction output을 의미하고 UTXO 전체 집합을 UTXO 집합이라고 함. UTXO 집합 = 현재 유통 중인 모든 비트코인

## 5.5 록타임

- 트랜잭션 전파 후 실행을 지연시키는 방법을 제공
- 값이 5억 이상이면 유닉스 타임으로 해석하고 5억 미만이면 블록 높이로 해석함
- 록타임이 의미하는 시점에 도달하기 전에는 입력이 가리키는 비트코인을 소비할 수 없음
- 입력에 포함된 시퀀스 값이 ffffffff이면 록타임 값은 무시됨
- 4바이트 리틀엔디언
- 록타임에 도달했을 때 트랜잭션 수신자가 트랜잭션이 유효한지 확신할 수 없는 문제 있음

## 5.6 트랜잭션 직렬화 코딩하기

- 파싱과 반대로 직렬화

## 5.7 트랜잭션 수수료

- 트랜잭션 입력 합은 출력의 합 이상이어야함
- 입력과 출력이 같은 경우는 거의 없고 그 차이는 수수료
- 수수료는 입력의 합에서 출력의 합을 뺀 값이며 이를 채굴자가 가져감
- 입력은 금액 필드가 없기 때문에 입력이 가리키는 이전 트랜잭션의 출력에서 찾아야 해서 UTXO 집합을 뒤져야함

## 5.8 마치며

- 아직 설명하지 않은 잠금 스크립트와 해제 스크립트는 비트코인의 스마트 계약 언어인 Script와 관련 있으며 6장에서 다룸


